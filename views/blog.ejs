<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('partials/head.ejs') %>
    <title><%= blog.title %> - Blogify</title>
    <style>
        body {
            background: #f8f9fa;
        }
        .blog-hero {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
        }
        .blog-content {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #495057;
        }
        .blog-meta-card {
            background: #f8f9fa;
            border-left: 3px solid #6c757d;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 1px solid #e9ecef;
        }
        .author-info {
            background: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
            border: 1px solid #e9ecef;
        }
        .cover-image {
            border-radius: 0.75rem;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        .action-buttons {
            background: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            margin-top: 2rem;
            border: 1px solid #e9ecef;
        }
        .reading-time {
            color: #6c757d;
            font-size: 0.9rem;
        }
        .blog-stats {
            background: #6c757d;
            color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
        }
        .btn-primary {
            background: #495057;
            border-color: #495057;
        }
        .btn-primary:hover {
            background: #343a40;
            border-color: #343a40;
        }
        .btn-outline-primary {
            color: #495057;
            border-color: #495057;
        }
        .btn-outline-primary:hover {
            background: #495057;
            border-color: #495057;
        }
    </style>
</head>
<body>
    <%- include('partials/nav.ejs', { user: user, error: null }) %>
    
    <!-- Hero Section -->
    <div class="blog-hero">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto text-center">
                    <h1 class="display-4 fw-bold mb-4"><%= blog.title %></h1>
                    <p class="lead opacity-90">
                        <i class="fas fa-clock me-2"></i>
                        <span class="reading-time">
                            <%= Math.ceil(blog.body.split(' ').length / 200) %> min read
                        </span>
                        <span class="mx-3">â€¢</span>
                        <i class="fas fa-calendar me-2"></i>
                        <%= blog.createdAt ? new Date(blog.createdAt).toLocaleDateString('en-US', { 
                            year: 'numeric', 
                            month: 'long', 
                            day: 'numeric'
                        }) : 'Unknown Date' %>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <!-- Main Content -->
            <div class="col-lg-8">
                <!-- Cover Image -->
                <% if (blog.coverImageURL) { %>
                    <img src="<%= blog.coverImageURL %>" 
                         class="img-fluid cover-image w-100" 
                         alt="<%= blog.title %>"
                         style="height: 400px; object-fit: cover;">
                <% } %>

                <!-- Author Info Card -->
                <div class="author-info">
                    <div class="d-flex align-items-center">
                        <div class="me-3">
                            <img src="<%= blog.createdBy.profileImage || 'https://via.placeholder.com/60x60/007bff/ffffff?text=' + blog.createdBy.fullname.charAt(0) %>" 
                                 alt="<%= blog.createdBy.fullname %>" 
                                 class="rounded-circle"
                                 style="width: 60px; height: 60px; object-fit: cover;">
                        </div>
                        <div class="flex-grow-1">
                            <h5 class="mb-1">
                                <a href="/user/profile/<%= blog.createdBy._id %>" 
                                   class="text-decoration-none text-primary">
                                    <%= blog.createdBy.fullname %>
                                </a>
                            </h5>
                            <p class="text-muted mb-0">
                                <i class="fas fa-user-edit me-1"></i>Author
                            </p>
                        </div>
                        <div class="text-end">
                            <small class="text-muted">
                                Published<br>
                                <%= blog.createdAt ? new Date(blog.createdAt).toLocaleDateString() : 'Unknown' %>
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Blog Content -->
                <div class="blog-content">
                    <div class="bg-white p-4 rounded-3 shadow-sm">
                        <div style="white-space: pre-wrap; line-height: 1.8;">
                            <%= blog.body %>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <div class="d-flex flex-wrap gap-2 justify-content-between align-items-center">
                        <div>
                            <a href="/" class="btn btn-outline-primary">
                                <i class="fas fa-arrow-left me-2"></i>Back to Home
                            </a>
                            <a href="/user/profile/<%= blog.createdBy._id %>" class="btn btn-outline-info">
                                <i class="fas fa-user me-2"></i>View Author Profile
                            </a>
                        </div>
                        <div>
                            <% if (user && blog.createdBy._id.toString() === user._id) { %>
                                <a href="/blog/edit/<%= blog._id %>" class="btn btn-success">
                                    <i class="fas fa-edit me-2"></i>Edit Post
                                </a>
                                <button class="btn btn-danger" 
                                        onclick="deletePost('<%= blog._id %>')">
                                    <i class="fas fa-trash me-2"></i>Delete
                                </button>
                            <% } else { %>
                                <button class="btn btn-outline-secondary" disabled>
                                    <i class="fas fa-share me-2"></i>Share
                                </button>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- Blog Stats -->
                <div class="blog-stats mb-4">
                    <h6 class="mb-3">
                        <i class="fas fa-chart-line me-2"></i>Post Statistics
                    </h6>
                    <div class="row text-center">
                        <div class="col-6">
                            <h4 class="mb-1"><%= blog.body.split(' ').length %></h4>
                            <small>Words</small>
                        </div>
                        <div class="col-6">
                            <h4 class="mb-1"><%= Math.ceil(blog.body.split(' ').length / 200) %></h4>
                            <small>Min Read</small>
                        </div>
                    </div>
                </div>

                <!-- Blog Meta Info -->
                <div class="blog-meta-card mb-4">
                    <h6 class="fw-bold mb-3">
                        <i class="fas fa-info-circle me-2"></i>Blog Details
                    </h6>
                    <div class="mb-2">
                        <small class="text-muted">Created:</small><br>
                        <strong>
                            <%= blog.createdAt ? new Date(blog.createdAt).toLocaleDateString('en-US', { 
                                weekday: 'long',
                                year: 'numeric', 
                                month: 'long', 
                                day: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            }) : 'Unknown Date' %>
                        </strong>
                    </div>
                    <% if (blog.updatedAt && blog.updatedAt > blog.createdAt) { %>
                        <div class="mb-2">
                            <small class="text-muted">Last Updated:</small><br>
                            <strong>
                                <%= new Date(blog.updatedAt).toLocaleDateString('en-US', { 
                                    weekday: 'long',
                                    year: 'numeric', 
                                    month: 'long', 
                                    day: 'numeric'
                                }) %>
                            </strong>
                        </div>
                    <% } %>
                    <div>
                        <small class="text-muted">Category:</small><br>
                        <span class="badge bg-primary">
                            <i class="fas fa-tag me-1"></i>General
                        </span>
                    </div>
                </div>

                <!-- Related Actions -->
                <div class="card">
                    <div class="card-header bg-light">
                        <h6 class="mb-0">
                            <i class="fas fa-tools me-2"></i>Quick Actions
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <a href="/blog/add-new" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-plus me-2"></i>Write New Post
                            </a>
                            <a href="/user/profile" class="btn btn-outline-info btn-sm">
                                <i class="fas fa-user me-2"></i>My Profile
                            </a>
                            <a href="/" class="btn btn-outline-secondary btn-sm">
                                <i class="fas fa-home me-2"></i>All Posts
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function deletePost(blogId) {
            if (confirm('Are you sure you want to delete this blog post? This action cannot be undone.')) {
                // Create a form and submit it for deletion
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = `/blog/delete/${blogId}`;
                
                // Add CSRF token if needed
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = '_method';
                csrfInput.value = 'DELETE';
                form.appendChild(csrfInput);
                
                document.body.appendChild(form);
                form.submit();
            }
        }

        // Smooth scroll to content
        document.addEventListener('DOMContentLoaded', function() {
            const links = document.querySelectorAll('a[href^="#"]');
            links.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });
        });
    </script>
    
    <%- include('partials/script.ejs') %>
</body>
</html>
